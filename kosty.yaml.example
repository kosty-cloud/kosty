# Kosty Configuration File Example
# Copy this file to kosty.yaml and customize for your needs

# Global exclusions (applied to all profiles unless overridden)
exclude:
  # Exclude specific AWS accounts
  accounts:
    - "123456789012"
    - "987654321098"
  
  # Exclude specific regions
  regions:
    - "ap-south-1"
    - "sa-east-1"
  
  # Exclude specific services
  services:
    - "route53"
    - "apigateway"
  
  # Exclude resources by ARN pattern
  arns:
    - "arn:aws:ec2:*:*:instance/i-protected*"
    - "arn:aws:s3:::production-*"
  
  # NEW: Exclude resources by tags
  tags:
    # Exclude any resource with this exact tag
    - key: "kosty_ignore"
      value: "true"
    
    # Exclude any resource with this tag (any value)
    - key: "Environment"
      value: "production"
    
    # Exclude resources tagged as protected
    - key: "Protected"
      value: "yes"
    
    # Exclude temporary resources
    - key: "Temporary"
      # No value means: exclude if tag key exists with any value

# Global thresholds (can be overridden per profile)
thresholds:
  ec2_cpu: 20          # EC2 oversized threshold (%)
  rds_cpu: 20          # RDS oversized threshold (%)
  stopped_days: 7      # Days before stopped instance flagged
  snapshot_days: 30    # Days before old snapshot flagged
  ami_days: 180        # Days before old AMI flagged

# Default settings (applied when no profile specified)
default:
  organization: false
  regions:
    - us-east-1
    - eu-west-1
  max_workers: 20
  output: console

# Profile definitions
profiles:
  # Customer 1 profile - Using AssumeRole (recommended for multi-account)
  customer01:
    regions:
      - us-east-1
    max_workers: 10
    role_arn: "arn:aws:iam::123456789012:role/KostyAuditRole"
    mfa_serial: "arn:aws:iam::123456789012:mfa/my-device"
    exclude:
      tags:
        - key: "Customer"
          value: "customer01-protected"
    thresholds:
      ec2_cpu: 15
      rds_cpu: 15
  
  # Customer 2 profile - Using AWS CLI profile (for local development)
  customer02:
    regions:
      - eu-west-1
    max_workers: 8
    aws_profile: "customer02-prod"  # References ~/.aws/credentials profile
    exclude:
      services:
        - "route53"
      tags:
        - key: "DoNotAudit"
  
  # Customer 3 profile - Using default credentials (env vars, instance role)
  customer03:
    regions:
      - ap-southeast-1
    max_workers: 5
    # No role_arn or aws_profile = uses default credentials
  
  # Production environment
  production:
    regions:
      - us-east-1
      - eu-west-1
      - ap-southeast-1
    max_workers: 15
    organization: true
    cross_account_role: "OrganizationAccountAccessRole"
    exclude:
      tags:
        - key: "Environment"
          value: "production"
        - key: "Critical"
    thresholds:
      ec2_cpu: 10
      rds_cpu: 10
      stopped_days: 3
  
  # Development environment
  development:
    regions:
      - us-east-1
    max_workers: 5
    exclude:
      tags:
        - key: "Temporary"
        - key: "Testing"
    thresholds:
      ec2_cpu: 30
      stopped_days: 14
